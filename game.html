<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>觸控網頁遊戲</title>
<style>
  canvas { 
    background: #87CEEB; 
    display: block; 
    margin: 0 auto; 
    border: 2px solid #000;
    touch-action: none; /* 防止手機滑動頁面 */
  }
  body { text-align: center; font-family: Arial, sans-serif; }
</style>
</head>
<body>
<h1>觸控網頁遊戲</h1>
<p>滑動控制角色，躲避敵人並吃道具！</p>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<p id="info">分數: 0 | 生命: 3 | 剩餘時間: 60</p>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = { x: 300, y: 200, size: 30 };
let score = 0;
let life = 3;
let time = 60;

let enemies = [];
let items = [];

// 觸控控制
let touchStart = null;
canvas.addEventListener('touchstart', e => {
  const t = e.touches[0];
  touchStart = { x: t.clientX, y: t.clientY };
});
canvas.addEventListener('touchmove', e => {
  e.preventDefault(); // 防止頁面滾動
  const t = e.touches[0];
  let dx = t.clientX - touchStart.x;
  let dy = t.clientY - touchStart.y;
  player.x += dx * 0.1; // 調整速度比例
  player.y += dy * 0.1;
  // 邊界限制
  if(player.x < 0) player.x = 0;
  if(player.x > canvas.width - player.size) player.x = canvas.width - player.size;
  if(player.y < 0) player.y = 0;
  if(player.y > canvas.height - player.size) player.y = canvas.height - player.size;
  touchStart = { x: t.clientX, y: t.clientY };
}, { passive: false });

// 生成敵人
function spawnEnemy() {
  enemies.push({
    x: Math.random() * (canvas.width - 20),
    y: 0,
    size: 20,
    speed: 2 + Math.random() * 2
  });
}

// 生成道具
function spawnItem() {
  items.push({
    x: Math.random() * (canvas.width - 20),
    y: Math.random() * (canvas.height - 20),
    size: 15
  });
}

// 遊戲循環
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 畫玩家
  ctx.fillStyle = 'green';
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // 更新敵人
  for(let i=enemies.length-1;i>=0;i--){
    let e = enemies[i];
    e.y += e.speed;
    ctx.fillStyle = 'red';
    ctx.fillRect(e.x, e.y, e.size, e.size);

    // 碰撞玩家
    if(e.x < player.x+player.size && e.x+e.size > player.x &&
       e.y < player.y+player.size && e.y+e.size > player.y){
      life--;
      enemies.splice(i,1);
    } else if(e.y > canvas.height){
      enemies.splice(i,1);
    }
  }

  // 更新道具
  for(let i=items.length-1;i>=0;i--){
    let it = items[i];
    ctx.fillStyle = 'yellow';
    ctx.fillRect(it.x,it.y,it.size,it.size);
    if(it.x < player.x+player.size && it.x+it.size > player.x &&
       it.y < player.y+player.size && it.y+it.size > player.y){
      score++;
      items.splice(i,1);
    }
  }

  document.getElementById('info').textContent = `分數: ${score} | 生命: ${life} | 剩餘時間: ${time}`;

  requestAnimationFrame(update);
}

// 每隔時間生成敵人/道具
setInterval(spawnEnemy, 1000);
setInterval(spawnItem, 3000);
setInterval(()=>{ time--; if(time<=0) alert('遊戲結束! 分數:'+score); },1000);

update();
</script>
</body>
</html>
